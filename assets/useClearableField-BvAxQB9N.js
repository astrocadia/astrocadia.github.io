import{b as x,_ as ve}from"./ThemeProviderWrapper-uQhE3vfQ.js";import{r as v}from"./index-Dl6G-zuu.js";import{g as Ie,u as Re}from"./utils-LIBDN8De.js";import{b as Se,d as Ee,u as _e,j as Fe,k as Oe,l as Ve,m as ke,n as Be,o as xe,p as Le,q as Qe,t as ye,v as $e,w as ze,x as Ue,y as je,z as We,A as ae,B as Ze,C as Ke}from"./valueManagers-DQiUa3Xx.js";import{u as Ae}from"./useTheme-CYpYpbD_.js";import{u as Ge}from"./useControlled-1Y2rT-1r.js";import{b as U,a as He}from"./useTimeout-B4b6mSVs.js";import{u as qe}from"./useForkRef-BDoLG09A.js";import{a as Ye}from"./index-DIU7Ih60.js";import{j as ie}from"./jsx-runtime-4WDyTGeM.js";import{I as Je}from"./IconButton-BRjw76_K.js";import{u as De}from"./useSlotProps-DeMrnH46.js";import{b as Xe}from"./InputAdornment-BINYG23M.js";const et=E=>{const n=Se(),e=Ee(),r=_e(),u=Ae().direction==="rtl",{valueManager:d,fieldValueManager:y,valueType:R,validator:Q,internalProps:$,internalProps:{value:Z,defaultValue:j,referenceDate:V,onChange:A,format:p,formatDensity:h="dense",selectedSections:c,onSelectedSectionsChange:o,shouldRespectLeadingZeros:l=!1,timezone:g}}=E,{timezone:S,value:b,handleValueChange:K}=Fe({timezone:g,value:Z,defaultValue:j,onChange:A,valueManager:d}),ne=v.useMemo(()=>Oe(n,S),[n,S]),W=v.useCallback((a,f=null)=>y.getSectionsFromValue(n,a,f,u,T=>Ve(n,S,e,p,T,h,l,u)),[y,p,e,u,l,n,h,S]),le=v.useMemo(()=>y.getValueStrFromSections(W(d.emptyValue),u),[y,W,d.emptyValue,u]),[D,O]=v.useState(()=>{const a=W(b),f={sections:a,value:b,referenceValue:d.emptyValue,tempValueStrAndroid:null},T=ke(a),P=d.getInitialReferenceValue({referenceDate:V,value:b,utils:n,props:$,granularity:T,timezone:S});return x({},f,{referenceValue:P})}),[w,ue]=Ge({controlled:c,default:null,name:"useField",state:"selectedSectionIndexes"}),re=a=>{ue(a),o==null||o(a),O(f=>x({},f,{selectedSectionQuery:null}))},N=v.useMemo(()=>{if(w==null)return null;if(w==="all")return{startIndex:0,endIndex:D.sections.length-1,shouldSelectBoundarySelectors:!0};if(typeof w=="number")return{startIndex:w,endIndex:w};if(typeof w=="string"){const a=D.sections.findIndex(f=>f.type===w);return{startIndex:a,endIndex:a}}return w},[w,D.sections]),L=({value:a,referenceValue:f,sections:T})=>{if(O(k=>x({},k,{sections:T,value:a,referenceValue:f,tempValueStrAndroid:null})),d.areValuesEqual(n,D.value,a))return;const P={validationError:Q({adapter:r,value:a,props:x({},$,{value:a,timezone:S})})};K(a,P)},I=(a,f)=>{const T=[...D.sections];return T[a]=x({},T[a],{value:f,modified:!0}),Le(T,u)},ce=()=>{L({value:d.emptyValue,referenceValue:D.referenceValue,sections:W(d.emptyValue)})},se=()=>{if(N==null)return;const a=D.sections[N.startIndex],f=y.getActiveDateManager(n,D,a),P=f.getSections(D.sections).filter(B=>B.value!=="").length===(a.value===""?0:1),k=I(N.startIndex,""),z=P?null:n.date(new Date("")),M=f.getNewValuesFromNewActiveDate(z);(z!=null&&!n.isValid(z))!=(f.date!=null&&!n.isValid(f.date))?L(x({},M,{sections:k})):O(B=>x({},B,M,{sections:k,tempValueStrAndroid:null}))},he=a=>{const f=(k,z)=>{const M=n.parse(k,p);if(M==null||!n.isValid(M))return null;const B=Ve(n,S,e,p,M,h,l,u);return xe(n,S,M,B,z,!1)},T=y.parseValueStr(a,D.referenceValue,f),P=y.updateReferenceValue(n,T,D.referenceValue);L({value:T,referenceValue:P,sections:W(T,D.sections)})},H=({activeSection:a,newSectionValue:f,shouldGoToNextSection:T})=>{T&&N&&N.startIndex<D.sections.length-1?re(N.startIndex+1):N&&N.startIndex!==N.endIndex&&re(N.startIndex);const P=y.getActiveDateManager(n,D,a),k=I(N.startIndex,f),z=P.getSections(k),M=Be(n,z);let B,J;if(M!=null&&n.isValid(M)){const q=xe(n,S,M,z,P.referenceDate,!0);B=P.getNewValuesFromNewActiveDate(q),J=!0}else B=P.getNewValuesFromNewActiveDate(M),J=(M!=null&&!n.isValid(M))!=(P.date!=null&&!n.isValid(P.date));return J?L(x({},B,{sections:k})):O(q=>x({},q,B,{sections:k,tempValueStrAndroid:null}))},Y=a=>O(f=>x({},f,{tempValueStrAndroid:a}));return v.useEffect(()=>{const a=W(D.value);O(f=>x({},f,{sections:a}))},[p,n.locale]),v.useEffect(()=>{let a=!1;d.areValuesEqual(n,D.value,b)?a=d.getTimezone(n,D.value)!==d.getTimezone(n,b):a=!0,a&&O(f=>x({},f,{value:b,referenceValue:y.updateReferenceValue(n,b,f.referenceValue),sections:W(b)}))},[b]),{state:D,selectedSectionIndexes:N,setSelectedSections:re,clearValue:ce,clearActiveSection:se,updateSectionValue:H,updateValueFromValueStr:he,setTempAndroidValueStr:Y,sectionsValueBoundaries:ne,placeholder:le,timezone:S}},tt=5e3,te=E=>E.saveQuery!=null,nt=({sections:E,updateSectionValue:n,sectionsValueBoundaries:e,setTempAndroidValueStr:r,timezone:i})=>{const u=Se(),[d,y]=v.useState(null),R=U(()=>y(null));v.useEffect(()=>{var V;d!=null&&((V=E[d.sectionIndex])==null?void 0:V.type)!==d.sectionType&&R()},[E,d,R]),v.useEffect(()=>{if(d!=null){const V=setTimeout(()=>R(),tt);return()=>{window.clearTimeout(V)}}return()=>{}},[d,R]);const Q=({keyPressed:V,sectionIndex:A},p,h)=>{const c=V.toLowerCase(),o=E[A];if(d!=null&&(!h||h(d.value))&&d.sectionIndex===A){const g=`${d.value}${c}`,S=p(g,o);if(!te(S))return y({sectionIndex:A,value:g,sectionType:o.type}),S}const l=p(c,o);return te(l)&&!l.saveQuery?(R(),null):(y({sectionIndex:A,value:c,sectionType:o.type}),te(l)?null:l)},$=V=>{const A=(c,o,l)=>{const g=o.filter(S=>S.toLowerCase().startsWith(l));return g.length===0?{saveQuery:!1}:{sectionValue:g[0],shouldGoToNextSection:g.length===1}},p=(c,o,l,g)=>{const S=b=>je(u,i,o.type,b);if(o.contentType==="letter")return A(o.format,S(o.format),c);if(l&&g!=null&&ze(u,l).contentType==="letter"){const b=S(l),K=A(l,b,c);return te(K)?{saveQuery:!1}:x({},K,{sectionValue:g(K.sectionValue,b)})}return{saveQuery:!1}};return Q(V,(c,o)=>{switch(o.type){case"month":{const l=g=>ye(u,g,u.formats.month,o.format);return p(c,o,u.formats.month,l)}case"weekDay":{const l=(g,S)=>S.indexOf(g).toString();return p(c,o,u.formats.weekday,l)}case"meridiem":return p(c,o);default:return{saveQuery:!1}}})},Z=V=>{const A=(h,c)=>{const o=+`${h}`,l=e[c.type]({currentDate:null,format:c.format,contentType:c.contentType});if(o>l.maximum)return{saveQuery:!1};if(o<l.minimum)return{saveQuery:!0};const g=+`${h}0`>l.maximum||h.length===l.maximum.toString().length;return{sectionValue:Ue(u,i,o,l,c),shouldGoToNextSection:g}};return Q(V,(h,c)=>{if(c.contentType==="digit"||c.contentType==="digit-with-letter")return A(h,c);if(c.type==="month"){const o=Qe(u,i,"digit","month","MM"),l=A(h,{type:c.type,format:"MM",hasLeadingZerosInFormat:o,hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2});if(te(l))return l;const g=ye(u,l.sectionValue,"MM",c.format);return x({},l,{sectionValue:g})}if(c.type==="weekDay"){const o=A(h,c);if(te(o))return o;const l=$e(u,i,c.format)[Number(o.sectionValue)-1];return x({},o,{sectionValue:l})}return{saveQuery:!1}},h=>!Number.isNaN(Number(h)))};return{applyCharacterEditing:U(V=>{const A=E[V.sectionIndex],h=!Number.isNaN(Number(V.keyPressed))?Z(V):$(V);h==null?r(null):n({activeSection:A,newSectionValue:h.sectionValue,shouldGoToNextSection:h.shouldGoToNextSection})}),resetCharacterQuery:R}},rt=["onClick","onKeyDown","onFocus","onBlur","onMouseUp","onPaste","error","clearable","onClear","disabled"],yt=E=>{const n=Se(),{state:e,selectedSectionIndexes:r,setSelectedSections:i,clearValue:u,clearActiveSection:d,updateSectionValue:y,updateValueFromValueStr:R,setTempAndroidValueStr:Q,sectionsValueBoundaries:$,placeholder:Z,timezone:j}=et(E),{inputRef:V,internalProps:A,internalProps:{readOnly:p=!1,unstableFieldRef:h,minutesStep:c},forwardedProps:{onClick:o,onKeyDown:l,onFocus:g,onBlur:S,onMouseUp:b,onPaste:K,error:ne,clearable:W,onClear:le,disabled:D},fieldValueManager:O,valueManager:w,validator:ue}=E,re=ve(E.forwardedProps,rt),{applyCharacterEditing:N,resetCharacterQuery:L}=nt({sections:e.sections,updateSectionValue:y,sectionsValueBoundaries:$,setTempAndroidValueStr:Q,timezone:j}),I=v.useRef(null),ce=qe(V,I),se=v.useRef(void 0),H=Ae().direction==="rtl",Y=v.useMemo(()=>We(e.sections,H),[e.sections,H]),a=()=>{var t;if(p){i(null);return}const s=(t=I.current.selectionStart)!=null?t:0;let m;s<=e.sections[0].startInInput||s>=e.sections[e.sections.length-1].endInInput?m=1:m=e.sections.findIndex(_=>_.startInInput-_.startSeparator.length>s);const C=m===-1?e.sections.length-1:m-1;i(C)},f=U((t,...s)=>{t.isDefaultPrevented()||(o==null||o(t,...s),a())}),T=U(t=>{b==null||b(t),t.preventDefault()}),P=U((...t)=>{g==null||g(...t);const s=I.current;window.clearTimeout(se.current),se.current=setTimeout(()=>{!s||s!==I.current||r!=null||p||(s.value.length&&Number(s.selectionEnd)-Number(s.selectionStart)===s.value.length?i("all"):a())})}),k=U((...t)=>{S==null||S(...t),i(null)}),z=U(t=>{if(K==null||K(t),p){t.preventDefault();return}const s=t.clipboardData.getData("text");if(r&&r.startIndex===r.endIndex){const m=e.sections[r.startIndex],C=/^[a-zA-Z]+$/.test(s),_=/^[0-9]+$/.test(s),F=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(s);if(m.contentType==="letter"&&C||m.contentType==="digit"&&_||m.contentType==="digit-with-letter"&&F)return;if(C||_){t.preventDefault();return}}t.preventDefault(),L(),R(s)}),M=U(t=>{if(p)return;const s=t.target.value;if(s===""){L(),u();return}const m=t.nativeEvent.data,C=m&&m.length>1,_=C?m:s,F=ae(_);if(r==null||C){R(C?m:F);return}let oe;if(r.startIndex===0&&r.endIndex===e.sections.length-1&&F.length===1)oe=F;else{const X=ae(O.getValueStrFromSections(e.sections,H));let de=-1,fe=-1;for(let G=0;G<X.length;G+=1)de===-1&&X[G]!==F[G]&&(de=G),fe===-1&&X[X.length-G-1]!==F[F.length-G-1]&&(fe=G);const ee=e.sections[r.startIndex];if(de<ee.start||X.length-fe-1>ee.end)return;const Ne=F.length-X.length+ee.end-ae(ee.endSeparator||"").length;oe=F.slice(ee.start+ae(ee.startSeparator||"").length,Ne)}if(oe.length===0){Ze()?Q(_):(L(),d());return}N({keyPressed:oe,sectionIndex:r.startIndex})}),B=U(t=>{switch(l==null||l(t),!0){case(t.key==="a"&&(t.ctrlKey||t.metaKey)):{t.preventDefault(),i("all");break}case t.key==="ArrowRight":{if(t.preventDefault(),r==null)i(Y.startIndex);else if(r.startIndex!==r.endIndex)i(r.endIndex);else{const s=Y.neighbors[r.startIndex].rightIndex;s!==null&&i(s)}break}case t.key==="ArrowLeft":{if(t.preventDefault(),r==null)i(Y.endIndex);else if(r.startIndex!==r.endIndex)i(r.startIndex);else{const s=Y.neighbors[r.startIndex].leftIndex;s!==null&&i(s)}break}case t.key==="Delete":{if(t.preventDefault(),p)break;r==null||r.startIndex===0&&r.endIndex===e.sections.length-1?u():d(),L();break}case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(t.key):{if(t.preventDefault(),p||r==null)break;const s=e.sections[r.startIndex],m=O.getActiveDateManager(n,e,s),C=Ke(n,j,s,t.key,$,m.date,{minutesStep:c});y({activeSection:s,newSectionValue:C,shouldGoToNextSection:!1});break}}});He(()=>{if(!I.current)return;if(r==null){I.current.scrollLeft&&(I.current.scrollLeft=0);return}const t=e.sections[r.startIndex],s=e.sections[r.endIndex];let m=t.startInInput,C=s.endInInput;if(r.shouldSelectBoundarySelectors&&(m-=t.startSeparator.length,C+=s.endSeparator.length),m!==I.current.selectionStart||C!==I.current.selectionEnd){const _=I.current.scrollTop;I.current===Ie(document)&&I.current.setSelectionRange(m,C),I.current.scrollTop=_}});const J=Re(x({},A,{value:e.value,timezone:j}),ue,w.isSameError,w.defaultErrorState),q=v.useMemo(()=>ne!==void 0?ne:w.hasError(J),[w,J,ne]);v.useEffect(()=>{!q&&!r&&L()},[e.referenceValue,r,q]),v.useEffect(()=>(I.current&&I.current===document.activeElement&&i("all"),()=>window.clearTimeout(se.current)),[]),v.useEffect(()=>{e.tempValueStrAndroid!=null&&r!=null&&(L(),d())},[e.tempValueStrAndroid]);const be=v.useMemo(()=>{var t;return(t=e.tempValueStrAndroid)!=null?t:O.getValueStrFromSections(e.sections,H)},[e.sections,O,e.tempValueStrAndroid,H]),we=v.useMemo(()=>r==null||e.sections[r.startIndex].contentType==="letter"?"text":"numeric",[r,e.sections]),Pe=I.current&&I.current===Ie(document),ge=w.areValuesEqual(n,e.value,w.emptyValue),Me=!Pe&&ge;v.useImperativeHandle(h,()=>({getSections:()=>e.sections,getActiveSectionIndex:()=>{var t,s;const m=(t=I.current.selectionStart)!=null?t:0,C=(s=I.current.selectionEnd)!=null?s:0;if(m===0&&C===0)return null;const _=m<=e.sections[0].startInInput?1:e.sections.findIndex(F=>F.startInInput-F.startSeparator.length>m);return _===-1?e.sections.length-1:_-1},setSelectedSections:t=>i(t)}));const Ce=U((t,...s)=>{var m;t.preventDefault(),le==null||le(t,...s),u(),I==null||(m=I.current)==null||m.focus(),i(0)});return x({placeholder:Z,autoComplete:"off",disabled:!!D},re,{value:Me?"":be,inputMode:we,readOnly:p,onClick:f,onFocus:P,onBlur:k,onPaste:z,onChange:M,onKeyDown:B,onMouseUp:T,onClear:Ce,error:q,ref:ce,clearable:!!(W&&!ge&&!p&&!D)})},me=["disablePast","disableFuture","minDate","maxDate","shouldDisableDate","shouldDisableMonth","shouldDisableYear"],pe=["disablePast","disableFuture","minTime","maxTime","shouldDisableClock","shouldDisableTime","minutesStep","ampm","disableIgnoringDatePartForTimeValidation"],Te=["minDateTime","maxDateTime"],st=[...me,...pe,...Te],Dt=E=>st.reduce((n,e)=>(E.hasOwnProperty(e)&&(n[e]=E[e]),n),{}),ot=["value","defaultValue","referenceDate","format","formatDensity","onChange","timezone","readOnly","onError","shouldRespectLeadingZeros","selectedSections","onSelectedSectionsChange","unstableFieldRef"],vt=(E,n)=>{const e=x({},E),r={},i=u=>{e.hasOwnProperty(u)&&(r[u]=e[u],delete e[u])};return ot.forEach(i),n==="date"?me.forEach(i):n==="time"?pe.forEach(i):n==="date-time"&&(me.forEach(i),pe.forEach(i),Te.forEach(i)),{forwardedProps:e,internalProps:r}},lt=["ownerState"],Et=({clearable:E,fieldProps:n,InputProps:e,onClear:r,slots:i,slotProps:u,components:d,componentsProps:y})=>{var R,Q,$,Z,j,V;const A=Ee(),p=(R=(Q=i==null?void 0:i.clearButton)!=null?Q:d==null?void 0:d.ClearButton)!=null?R:Je,h=De({elementType:p,externalSlotProps:($=u==null?void 0:u.clearButton)!=null?$:y==null?void 0:y.clearButton,ownerState:{},className:"clearButton",additionalProps:{title:A.fieldClearLabel}}),c=ve(h,lt),o=(Z=(j=i==null?void 0:i.clearIcon)!=null?j:d==null?void 0:d.ClearIcon)!=null?Z:Ye,l=De({elementType:o,externalSlotProps:(V=u==null?void 0:u.clearIcon)!=null?V:y==null?void 0:y.clearIcon,ownerState:{}}),g=x({},e,{endAdornment:E?ie.jsxs(v.Fragment,{children:[ie.jsx(Xe,{position:"end",sx:{marginRight:e!=null&&e.endAdornment?-1:-1.5},children:ie.jsx(p,x({},c,{onClick:r,children:ie.jsx(o,x({fontSize:"small"},l))}))}),e==null?void 0:e.endAdornment]}):e==null?void 0:e.endAdornment}),S=x({},n,{sx:[{"& .clearButton":{opacity:1},"@media (pointer: fine)":{"& .clearButton":{opacity:0},"&:hover, &:focus-within":{".clearButton":{opacity:1}}}},...Array.isArray(n.sx)?n.sx:[n.sx]]});return{InputProps:g,fieldProps:S}};export{Et as a,Dt as e,vt as s,yt as u};
