import{j as o}from"./jsx-runtime-4WDyTGeM.js";import{r as t}from"./index-Dl6G-zuu.js";import{z as J}from"./index-dIKOytT1.js";import{T as I}from"./store-DcPsTEhE.js";import{E as P}from"./exhibitComponents-B3YvCMnA.js";import"./ControlledTextField-DVeGBoB-.js";import{T as B}from"./TextField-W3uF_ooE.js";import{I as Q}from"./InputAdornment-BINYG23M.js";import"./index-Bu4DXql-.js";import{C as Z}from"./CustomHardwarePropertyArrayWrapper-BVXXOkWr.js";import{C as ee}from"./CustomHardwareFieldPropertyWrapper-Cw72Oe9H.js";import{A as ae,M as re,a as te,I as ne,F as se,B as le,b as H,S as oe}from"./constants-nrIgCRYB.js";import{i as g}from"./lang-BqISUGWn.js";import{b as ue}from"./eventHelpers-DNy-jsQX.js";import{D as ie}from"./Dot-B-sjopOf.js";const k=({property:e,propertyName:S,disabled:u,onSendValue:V,mutationStateAndActions:G,onAddToast:f,arraySubpage:W,onSetArraySubpage:Y,onArraySubpageBack:$})=>{const[n,h]=t.useState(Array(e.arrayLength).fill(void 0)),[s,C]=t.useState(Array(e.arrayLength).fill(null)),[i,v]=t.useState(Array(e.arrayLength).fill(null)),[x,N]=t.useState(!1),[d,X]=t.useState(Math.min(e.arrayLength,ae)),y=t.useRef(!1),{min:M,max:T}=e,A=J.number().gte(M??-1/0,`${re} ${M}`).lte(T??1/0,`${te} ${T}`).nullable(),{isSuccess:m,isLoading:p,resetUpdatePropertyMutation:U}=G,D=t.useCallback((r,a)=>{const l=a.target.value?Number(a.target.value):null;h(R=>R.map((E,K)=>K===r?l:E)),y.current=!0;const c=A.safeParse(l);v(R=>{const E=[...R];return c.success?E[r]=null:E[r]=c.error.issues[0].message,E})},[A]),b=t.useMemo(()=>Math.max(n.findLastIndex(r=>!g(r)),s.findLastIndex(r=>r!==null)),[n,s]),F=t.useMemo(()=>{switch(e.format){case P.BYTE:return le;case P.FLOAT:return se;case P.INTEGER:return ne;default:return"—"}},[e.format]),w=t.useMemo(()=>n.some((r,a)=>!g(r)&&r!==s[a]),[n,s]),L=t.useMemo(()=>i.some(r=>!!r)||b<0||!n.slice(0,b+1).every((r,a)=>r!==null&&(r!==void 0||s[a]!==null)),[i,n,s,b]),_=t.useCallback(()=>{L||u||p||m||V(n.slice(0,b+1).map((r,a)=>g(r)?s[a]:r))},[V,n,s,b,L,u,p,m]),j=t.useMemo(()=>d>H?d-H:0,[d]),O=t.useMemo(()=>{const r=[];for(let a=j;a<d;a++)r.push(o.jsxs("div",{className:"NumberComponentProperty__row",children:[e.arrayLength>1&&o.jsx(B,{helperText:i[a]?" ":"",className:"NumberComponentProperty__rowIndex",placeholder:a.toString(),disabled:!0}),o.jsx(B,{onWheel:l=>l.target.blur(),error:!!i[a],helperText:i[a],fullWidth:!0,orientation:"horizontal",type:"number",placeholder:e.settable?F:"—",disabled:u||!e.settable,value:(n[a]!==void 0?n[a]:s[a])??"",onChange:l=>D(a,l),onKeyDown:ue(_),InputProps:e.arrayLength>1&&!g(n[a])&&n[a]!==s[a]?{endAdornment:o.jsx(Q,{className:"NumberComponentProperty__adornmentDot",position:"end",children:o.jsx(ie,{color:"var(--base-color-orange-400)"})})}:{}})]},a));return o.jsx("div",{className:"NumberComponentProperty__propertyValues",children:r})},[u,i,D,_,j,d,n,s,e.arrayLength,e.settable,F]);t.useEffect(()=>{y.current?N(!0):C(e.value??Array(e.arrayLength).fill(null))},[e.value,e.arrayLength]),t.useEffect(()=>{m&&(y.current=!1,e.arrayLength>1&&f(`${S} values sent`,I.SUCCESS),setTimeout(()=>{C(r=>r.map((a,l)=>g(n[l])?a:n[l])),h(Array(e.arrayLength).fill(void 0)),N(!1),U()},oe))},[m,p,n,e.arrayLength,U,f,S]);const q=t.useCallback(()=>{y.current=!1,h(Array(e.arrayLength).fill(void 0)),C(e.value??Array(e.arrayLength).fill(null)),N(!1),v(Array(e.arrayLength).fill(null))},[e.value,e.arrayLength]),z=t.useCallback(r=>{if(r.some(a=>!A.safeParse(Number(a)).success)){f("File failed to upload",I.ERROR);return}h(a=>a.map((l,c)=>r[c]&&r[c]!==""?Number(r[c]):l)),f("File Uploaded",I.SUCCESS)},[h,A,f]);return e.arrayLength>1?o.jsx(Z,{className:"NumberComponentProperty",propertyName:S,propertyLength:e.arrayLength,propertyChanged:w,settable:e.settable,downloadData:s.map((r,a)=>n[a]??r).join(","),disabled:u,sendDisabled:L,loading:p,success:m,showRefreshButton:x,onRefresh:q,onSendValue:_,onUpdate:z,arraySubpage:!!W,onSetArraySubpage:Y,onArraySubpageBack:$,renderedFieldsEndIndex:d,setRenderedFieldsEndIndex:X,children:O}):o.jsx(ee,{className:"NumberComponentProperty",settable:e.settable,propertyName:S,propertyChanged:w,disabled:u||L,loading:p,success:m,showRefreshButton:x,onRefresh:q,onSendValue:_,children:e.settable?O:(e.value&&e.value[0])??"—"})};try{k.displayName="NumberComponentProperty",k.__docgenInfo={description:"",displayName:"NumberComponentProperty",props:{property:{defaultValue:null,description:"",name:"property",required:!0,type:{name:"NumberProperty"}},propertyName:{defaultValue:null,description:"",name:"propertyName",required:!0,type:{name:"string"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onSendValue:{defaultValue:null,description:"",name:"onSendValue",required:!0,type:{name:"(values: (number | number[])[] | undefined) => void"}},mutationStateAndActions:{defaultValue:null,description:"",name:"mutationStateAndActions",required:!0,type:{name:"{ isLoading: boolean; isSuccess: boolean; resetUpdatePropertyMutation: () => void; }"}},onAddToast:{defaultValue:null,description:"",name:"onAddToast",required:!0,type:{name:"(message: string, type: ToastType) => void"}},arraySubpage:{defaultValue:null,description:"",name:"arraySubpage",required:!0,type:{name:"boolean"}},onSetArraySubpage:{defaultValue:null,description:"",name:"onSetArraySubpage",required:!0,type:{name:"() => void"}},onArraySubpageBack:{defaultValue:null,description:"",name:"onArraySubpageBack",required:!0,type:{name:"() => void"}}}}}catch{}export{k as N};
