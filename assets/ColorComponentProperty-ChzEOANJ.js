import{j as c}from"./jsx-runtime-4WDyTGeM.js";import{r as n}from"./index-Dl6G-zuu.js";import{m as R,C as j}from"./ColorInput-BOsOMhlT.js";import{T as P}from"./store-DcPsTEhE.js";import{A as X,b as w,S as Y}from"./constants-nrIgCRYB.js";import{C as $}from"./CustomHardwareFieldPropertyWrapper-C3ugBqIj.js";import{C as K}from"./CustomHardwarePropertyArrayWrapper-Cg8S4q4W.js";import"./ControlledTextField-Dxj0VxPy.js";import{T as J}from"./TextField-ifwCBnOs.js";import{i as A,b as U}from"./exhibitComponents-B3YvCMnA.js";const F=({white:e,red:i,green:o,blue:d})=>`#${[i,o,d,e].map(m=>m.toString(16).padStart(2,"0")).join("")}`,Q=e=>{if(!e)return{red:0,green:0,blue:0,white:0};const o=e.replace("#",""),d=parseInt(o.substring(0,2),16),m=parseInt(o.substring(2,4),16),u=parseInt(o.substring(4,6),16),y=parseInt(o.substring(6,8),16);return{white:A(y)?y:0,red:A(d)?d:0,green:A(m)?m:0,blue:A(u)?u:0}},Z="Select or enter color value",q=({property:e,propertyName:i,disabled:o,onSendValue:d,mutationStateAndActions:m,onAddToast:u,arraySubpage:y,onSetArraySubpage:z,onArraySubpageBack:N})=>{const[t,g]=n.useState(Array(e.arrayLength).fill(null)),[l,_]=n.useState(Array(e.arrayLength).fill(null)),[x,L]=n.useState(!1),[f,k]=n.useState(Math.min(e.arrayLength,X)),b=n.useRef(!1),{isSuccess:p,isLoading:h,resetUpdatePropertyMutation:I}=m,v=n.useCallback((a,r)=>{const s=r;g(C=>C.map((O,W)=>W===a?s:O)),b.current=!0},[]),S=n.useMemo(()=>Math.max(t.findLastIndex(a=>a&&a!==""),l.findLastIndex(a=>a&&a!=="")),[t,l]),M=n.useMemo(()=>t.some((a,r)=>a&&a!==l[r]),[t,l]),V=n.useMemo(()=>S<0||!t.slice(0,S+1).every((a,r)=>a!==null?R(a):l[r]&&R(l[r])),[t,l,S]),E=n.useCallback(()=>{V||o||h||p||d(t.slice(0,S+1).map((a,r)=>Q(a&&a!==""?a:l[r])))},[d,l,t,S,V,o,h,p]),T=n.useMemo(()=>f>w?f-w:0,[f]),G=a=>r=>{if(r.key==="Enter"){if(r.target.classList.contains("MuiButtonBase-root"))return;a()}},B=n.useMemo(()=>{const a=[];for(let r=T;r<f;r++)a.push(c.jsxs("div",{className:"ColorComponentProperty__row",children:[e.arrayLength>1&&c.jsx(J,{className:"ColorComponentProperty__rowIndex",placeholder:r.toString(),disabled:!0}),c.jsx(j,{format:"hex8",onChange:s=>v(r,s),placeholder:e.settable?Z:"—",disabled:o||!e.settable,value:t[r]??l[r]??"",changed:e.arrayLength>1&&!!t[r]&&t[r]!==l[r],onKeyDown:G(E)})]},r));return c.jsx("div",{className:"ColorComponentProperty__propertyValues",children:a})},[o,v,E,T,f,t,l,e.arrayLength,e.settable]);n.useEffect(()=>{b.current?L(!0):_(e.value?e.value.map(a=>U(a)?F(a):null):Array(e.arrayLength).fill(null))},[e.value,e.arrayLength]),n.useEffect(()=>{p&&(b.current=!1,e.arrayLength>1&&u(`${i} values sent`,P.SUCCESS),setTimeout(()=>{_(a=>a.map((r,s)=>t[s]&&t[s]!==""?t[s]:r??"")),g(Array(e.arrayLength).fill(null)),L(!1),I()},Y))},[p,h,t,u,i,I,e.arrayLength]);const D=n.useCallback(()=>{b.current=!1,g(Array(e.arrayLength).fill(null)),_(e.value??Array(e.arrayLength).fill(null)),L(!1)},[e.value,e.arrayLength]),H=n.useCallback(a=>{if(a.some(r=>!R(r)&&r!=="")){u("File failed to upload",P.ERROR);return}g(r=>r.map((s,C)=>a[C]&&a[C]!==""?a[C]:s)),u("File Uploaded",P.SUCCESS)},[g,u]);return e.arrayLength>1?c.jsx(K,{className:"ColorComponentProperty",propertyName:i,propertyLength:e.arrayLength,propertyChanged:M,settable:e.settable,downloadData:l.map((a,r)=>t[r]??a).join(","),disabled:o,sendDisabled:V,loading:h,success:p,showRefreshButton:x,onRefresh:D,onSendValue:E,onUpdate:H,arraySubpage:!!y,onSetArraySubpage:z,onArraySubpageBack:N,renderedFieldsEndIndex:f,setRenderedFieldsEndIndex:k,children:B}):c.jsx($,{className:"ColorComponentProperty",settable:e.settable,propertyName:i,propertyChanged:M,disabled:o||V||t[0]==="",loading:h,success:p,showRefreshButton:x,onRefresh:D,onSendValue:E,children:e.settable?B:c.jsx(j,{format:"hex8",value:e.value&&U(e.value[0])?F(e.value[0]):"",placeholder:"—",disabled:!0})})};try{q.displayName="ColorComponentProperty",q.__docgenInfo={description:"",displayName:"ColorComponentProperty",props:{property:{defaultValue:null,description:"",name:"property",required:!0,type:{name:"ColorProperty"}},propertyName:{defaultValue:null,description:"",name:"propertyName",required:!0,type:{name:"string"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},onSendValue:{defaultValue:null,description:"",name:"onSendValue",required:!0,type:{name:"(values: (ColorPropertyValue | ColorPropertyValue[])[] | undefined) => void"}},mutationStateAndActions:{defaultValue:null,description:"",name:"mutationStateAndActions",required:!0,type:{name:"{ isLoading: boolean; isSuccess: boolean; resetUpdatePropertyMutation: () => void; }"}},onAddToast:{defaultValue:null,description:"",name:"onAddToast",required:!0,type:{name:"(message: string, type: ToastType) => void"}},arraySubpage:{defaultValue:null,description:"",name:"arraySubpage",required:!0,type:{name:"boolean"}},onSetArraySubpage:{defaultValue:null,description:"",name:"onSetArraySubpage",required:!0,type:{name:"() => void"}},onArraySubpageBack:{defaultValue:null,description:"",name:"onArraySubpageBack",required:!0,type:{name:"() => void"}}}}}catch{}export{q as C};
